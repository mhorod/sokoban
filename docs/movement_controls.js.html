<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: movement_controls.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: movement_controls.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Part responsible for capturing user input

let action_queue = []

let can_apply_move_instantly = true

let current_event_listener = undefined


// The process used by two below function smoothes movement a little bit
// Player cannot zoom through the board or cut corners

NEXT_ACTION_TIMEOUT = 100 // Time (in miliseconds) between two consecutive actions
MAX_ACTIONS_IN_QUEUE = 3 // How many actions can be in queue, if queue is full events are ignored

/** Queues action to be handled and handles it as soon as it's possible
 * 
 * @param {Function} handler 
 * @param {any} action 
 */
function apply_action(handler, action) {
  if (action_queue.length &lt; MAX_ACTIONS_IN_QUEUE)
    action_queue.push(action)
  if (can_apply_move_instantly) { next_queued_action(handler) }
}

/** Processes actions.
 *  When there are no waiting actions, the next one can be applied immediately.
 *  Otherwise try to apply every action until the first success
 * 
 *  @param {Function} handler 
 */
function next_queued_action(handler) {
  if (action_queue.length === 0) {
    can_apply_move_instantly = true
    return
  }
  can_apply_move_instantly = false
  while (action_queue.length > 0 &amp;&amp; !handler(action_queue.shift()));
  setTimeout(() => next_queued_action(handler), NEXT_ACTION_TIMEOUT)
}

/**
 * Removes previously set binding of keyboard events
 */
function unlink_controls() {
  document.removeEventListener("keydown", current_event_listener)
}

/** Binds keyboard events to game actions, and calls provided handler on action 
 * 
 * @param {function} handler 
 */
function link_controls(handler) {
  unlink_controls()
  action_queue = []
  current_event_listener = e => {
    if (e.code === "KeyA" || e.code === "KeyH" || e.code === "ArrowLeft")
      apply_action(handler, Actions.MOVE_LEFT)
    else if (e.code === "KeyD" || e.code === "KeyL" || e.code === "ArrowRight")
      apply_action(handler, Actions.MOVE_RIGHT)
    else if (e.code === "KeyW" || e.code === "KeyK" || e.code === "ArrowUp")
      apply_action(handler, Actions.MOVE_UP)
    else if (e.code === "KeyS" || e.code === "KeyJ" || e.code === "ArrowDown")
      apply_action(handler, Actions.MOVE_DOWN)
    else if (e.code == "KeyR")
      apply_action(handler, Actions.RESTART)
  }
  document.addEventListener("keydown", current_event_listener)
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BasicLevelDisplay.html">BasicLevelDisplay</a></li><li><a href="Game.html">Game</a></li><li><a href="GameLogic.html">GameLogic</a></li><li><a href="GameState.html">GameState</a></li><li><a href="Level.html">Level</a></li><li><a href="LevelDisplay.html">LevelDisplay</a></li><li><a href="LoadFromCookie.html">LoadFromCookie</a></li><li><a href="RankingEntry.html">RankingEntry</a></li><li><a href="SatisfactionCounter.html">SatisfactionCounter</a></li><li><a href="SaveToCookie.html">SaveToCookie</a></li></ul><h3>Global</h3><ul><li><a href="global.html#accept_cookies">accept_cookies</a></li><li><a href="global.html#action_to_offset">action_to_offset</a></li><li><a href="global.html#Actions">Actions</a></li><li><a href="global.html#add_finish_button_to_level_game_wrapper">add_finish_button_to_level_game_wrapper</a></li><li><a href="global.html#apply_action">apply_action</a></li><li><a href="global.html#apply_edition">apply_edition</a></li><li><a href="global.html#apply_game_action">apply_game_action</a></li><li><a href="global.html#arrays_equal">arrays_equal</a></li><li><a href="global.html#can_move_or_push">can_move_or_push</a></li><li><a href="global.html#can_push_box">can_push_box</a></li><li><a href="global.html#can_walk_into_without_pushing">can_walk_into_without_pushing</a></li><li><a href="global.html#check_cookies_accepted">check_cookies_accepted</a></li><li><a href="global.html#clone_game">clone_game</a></li><li><a href="global.html#clone_level">clone_level</a></li><li><a href="global.html#create_level_ui">create_level_ui</a></li><li><a href="global.html#create_new_level">create_new_level</a></li><li><a href="global.html#create_satisfaction_counter">create_satisfaction_counter</a></li><li><a href="global.html#deep_array_copy">deep_array_copy</a></li><li><a href="global.html#draw_level">draw_level</a></li><li><a href="global.html#erase">erase</a></li><li><a href="global.html#get_box_index">get_box_index</a></li><li><a href="global.html#get_cookie">get_cookie</a></li><li><a href="global.html#get_target_index">get_target_index</a></li><li><a href="global.html#get_user_level_by_index">get_user_level_by_index</a></li><li><a href="global.html#get_user_level_by_name">get_user_level_by_name</a></li><li><a href="global.html#insert_into_ranking">insert_into_ranking</a></li><li><a href="global.html#is_box_satisfied">is_box_satisfied</a></li><li><a href="global.html#is_level_completed">is_level_completed</a></li><li><a href="global.html#is_level_valid">is_level_valid</a></li><li><a href="global.html#link_controls">link_controls</a></li><li><a href="global.html#load_game_state">load_game_state</a></li><li><a href="global.html#move_box_from">move_box_from</a></li><li><a href="global.html#move_box_to">move_box_to</a></li><li><a href="global.html#move_game_to_ranking">move_game_to_ranking</a></li><li><a href="global.html#next_queued_action">next_queued_action</a></li><li><a href="global.html#place">place</a></li><li><a href="global.html#play_edited_level">play_edited_level</a></li><li><a href="global.html#play_game">play_game</a></li><li><a href="global.html#play_level_at">play_level_at</a></li><li><a href="global.html#play_level_on_default_game_wrapper">play_level_on_default_game_wrapper</a></li><li><a href="global.html#play_single_level">play_single_level</a></li><li><a href="global.html#push_box">push_box</a></li><li><a href="global.html#remove_box">remove_box</a></li><li><a href="global.html#remove_cookie">remove_cookie</a></li><li><a href="global.html#remove_finish_button_from_game_wrapper">remove_finish_button_from_game_wrapper</a></li><li><a href="global.html#remove_from_ranking">remove_from_ranking</a></li><li><a href="global.html#remove_paused_user_level">remove_paused_user_level</a></li><li><a href="global.html#remove_saved_game">remove_saved_game</a></li><li><a href="global.html#remove_target">remove_target</a></li><li><a href="global.html#remove_user_level">remove_user_level</a></li><li><a href="global.html#remove_wall">remove_wall</a></li><li><a href="global.html#reset_buttons_state">reset_buttons_state</a></li><li><a href="global.html#reset_game_state">reset_game_state</a></li><li><a href="global.html#resize_level">resize_level</a></li><li><a href="global.html#resize_level_or_show_error">resize_level_or_show_error</a></li><li><a href="global.html#satisfied_boxes_count">satisfied_boxes_count</a></li><li><a href="global.html#save_game">save_game</a></li><li><a href="global.html#save_game_state">save_game_state</a></li><li><a href="global.html#save_new_user_level">save_new_user_level</a></li><li><a href="global.html#save_paused_user_level">save_paused_user_level</a></li><li><a href="global.html#save_user_level">save_user_level</a></li><li><a href="global.html#set_cookie">set_cookie</a></li><li><a href="global.html#split_levels_by_difficulty">split_levels_by_difficulty</a></li><li><a href="global.html#unlink_controls">unlink_controls</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Mar 28 2021 18:01:26 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
